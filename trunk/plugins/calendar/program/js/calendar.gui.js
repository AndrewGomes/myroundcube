function calendar_gui(){window.rcmail&&(rcmail.env.calendar_gui_initialized=!1);this.init=function(a){document.getElementById("event-1")||document.writeln('Update to Roundcube v.0.5 or modify ./program/include/rcube_template.php <a href="http://trac.roundcube.net/ticket/1487133">Show the hack</a>');if(rcmail.env.calsearch_id){var b=$("#calendar").fullCalendar("clientEvents",rcmail.env.calsearch_id);if(b&&b[0]){rcmail.env.calsearch_id=false;rcmail.env.calendar_gui_initialized=true;calendar_callbacks.eventClick(b[0],
rcmail.env.calsettings);return}rcmail.env.calsearch_id=false}if(rcmail.env.calendar_gui_initialized)$("#upcoming").fullCalendar("removeEvents");else{rcmail.env.calendar_gui_initialized=true;queryString("_view")!="false"&&$("#calendar").fullCalendar("changeView",queryString("_view"));rcmail.env.skin=="larry"&&$("#calendar-header").attr("class","ui-widget-header");if(queryString("_event_id")!="false"&&queryString("_date")!="false"){rcmail.env.ts=queryString("_date");rcmail.env.id=queryString("_event_id");
calendar_commands.gotoDate(rcmail.env.ts,rcmail.env.id);rcmail.env.calendar_gui_initialized=false}if(queryString("_date")!="false"){var b=$("#calendar").fullCalendar("getDate"),d=$.fullCalendar.parseDate(new Date(queryString("_date")*1E3));(b.getDate()!=d.getDate()||b.getMonth()!=d.getMonth()||b.getFullYear()!=d.getFullYear())&&$("#calendar").fullCalendar("gotoDate",$.fullCalendar.parseDate(new Date(queryString("_date")*1E3)))}this.upcoming(a);if(!rcmail.env.google_ads){a=0;rcmail.env.skin=="larry"&&
(a=110);$("#calsearchdialog").dialog({autoOpen:false,modal:false,resizable:false,width:285,height:250,position:[$("#calquicksearchbar").position().left-a,$("#calquicksearchbar").position().top+30]})}$("#calsearchfilter").click(function(){$("#calsearchset").hide();$("#calsearchfilter").val().length>2&&$("#calsearchdialog").dialog("open");$("#calsearchfilter").focus()});$("#calsearchfilter").bind("keypress",function(a){if(rcube_event.get_keycode(a)==13){rcmail.env.cal_search_string="";calendar_commands.triggerSearch();
return false}});$("#calsearchfilter").bind("keyup",function(){calendar_commands.triggerSearch()});$("#calsearchreset").click(function(){$("#calsearchdialog").dialog("close");$("#calsearchfilter").val("");$("#calsearch_table").html("")});$("#calsearchmod").click(function(){$("#calsearchset").toggle()});$("#todaybut").click(function(){$("#jqdatepicker").datepicker("setDate",new Date);$("#calendar").fullCalendar("today");$("#upcoming").fullCalendar("today")});$("#prevbut").click(function(){rcmail.env.onChangeMonthYear=
false;$("#calendar").fullCalendar("prev");var a=new Date($("#calendar").fullCalendar("getDate")),b=new Date;b.setTime(a.getTime()+864E5);$("#calendar").fullCalendar("select",a,b,false)});$("#nextbut").click(function(){rcmail.env.onChangeMonthYear=false;$("#calendar").fullCalendar("next");var a=new Date($("#calendar").fullCalendar("getDate")),b=new Date;b.setTime(a.getTime()+864E5);$("#calendar").fullCalendar("select",a,b,false)});$("#daybut").click(function(){$("#calendar").fullCalendar("changeView",
"agendaDay")});$("#weekbut").click(function(){$("#calendar").fullCalendar("changeView","agendaWeek")});$("#monthbut").click(function(){$("#calendar").fullCalendar("changeView","month")});$("#jqdatepicker").mousedown(function(){rcmail.env.onChangeMonthYear=true});$("#form").keypress(function(){$("#event").tabs("disable",3)});$("#starttime").click(function(){$("#event").tabs("disable",3)});$("#endtime").click(function(){$("#event").tabs("disable",3)});$("#startdate").click(function(){$("#event").tabs("disable",
3)});$("#enddate").click(function(){$("#event").tabs("disable",3)});$("#c1").click(function(){calendar_gui.nums(1,"dnums",31)});$("#c2").click(function(){calendar_gui.nums(-1,"dnums",31)});$("#c3").click(function(){calendar_gui.nums(1,"wnums",99)});$("#c4").click(function(){calendar_gui.nums(-1,"wnums",99)});$("#c5").click(function(){calendar_gui.nums(1,"mnums",99)});$("#c6").click(function(){calendar_gui.nums(-1,"mnums",99)});$("#c7").click(function(){calendar_gui.nums(1,"ynums",99)});$("#c8").click(function(){calendar_gui.nums(-1,
"ynums",99)});$("#c9").click(function(){calendar_gui.nums(1,"ydnums",99);calendar_gui.resetYear("advanced")});$("#c10").click(function(){calendar_gui.nums(-1,"ydnums",99);calendar_gui.resetYear("advanced")});$("#c11").click(function(){calendar_gui.nums(1,"occurrences",99)});$("#c12").click(function(){calendar_gui.nums(-1,"occurrences",99)});$("#schedule").hide();$("#recurselnever").click(function(){$("#recursel").prop("selectedIndex",0);calendar_gui.resetDay();calendar_gui.resetWeek();calendar_gui.resetMonth("advanced");
calendar_gui.resetMonth("occurrences");calendar_gui.resetMonth();calendar_gui.resetYear("advanced");calendar_gui.resetYear("occurrences");calendar_gui.resetYear();$("#everyweekdiv").hide();$("#everymonthdiv").hide();$("#everyyeardiv").hide();$("#everydaydiv").hide();$("#occurences").val(1);calendar_gui.toggleRecur();$("#expires").val(rcmail.env.remember_expires);rcmail.env.recurselnever=true});$("#daylink").click(function(){rcmail.env.event_initial=false;if($("#everydaydiv").attr("style").indexOf("none")==
-1){$("#recursel").prop("selectedIndex",0);$("#schedule").hide();$("#reset").hide();calendar_gui.resetDay()}else{$("#recursel").prop("selectedIndex",1);$("#schedule").show();$("#reset").show();calendar_gui.resetWeek();calendar_gui.resetMonth("advanced");calendar_gui.resetMonth("occurrences");calendar_gui.resetMonth();calendar_gui.resetYear("advanced");calendar_gui.resetYear("occurrences");calendar_gui.resetYear()}});$("#weeklink").click(function(){rcmail.env.event_initial=false;if($("#everyweekdiv").attr("style").indexOf("none")==
-1){$("#recursel").prop("selectedIndex",0);$("#schedule").hide();$("#reset").hide();calendar_gui.resetWeek()}else{$("#recursel").prop("selectedIndex",3);$("#schedule").show();$("#reset").show();calendar_gui.resetDay();calendar_gui.resetMonth("advanced");calendar_gui.resetMonth("occurrences");calendar_gui.resetMonth();calendar_gui.resetYear("advanced");calendar_gui.resetYear("occurrences");calendar_gui.resetYear()}});$("#monthlink").click(function(){rcmail.env.event_initial=false;if($("#everymonthdiv").attr("style").indexOf("none")==
-1){$("#recursel").prop("selectedIndex",0);$("#schedule").hide();$("#reset").hide();calendar_gui.resetMonth("advanced");calendar_gui.resetMonth("occurrences");calendar_gui.resetMonth()}else{$("#recursel").prop("selectedIndex",4);$("#schedule").show();$("#reset").show();calendar_gui.resetDay();calendar_gui.resetWeek();calendar_gui.resetYear("advanced");calendar_gui.resetYear("occurrences");calendar_gui.resetYear()}});$("#yearlink").click(function(){rcmail.env.event_initial=false;if($("#everyyeardiv").attr("style").indexOf("none")==
-1){$("#recursel").prop("selectedIndex",0);$("#schedule").hide();$("#reset").hide()}else{$("#recursel").prop("selectedIndex",5);$("#schedule").show();$("#reset").show();calendar_gui.resetDay();calendar_gui.resetWeek()}calendar_gui.resetYear("advanced");calendar_gui.resetYear("occurrences");calendar_gui.resetYear()});$("#workdaylink").click(function(){$("#recursel").prop("selectedIndex",2)});$("#byweekdaylink").click(function(){calendar_gui.resetMonth("advanced")});$("#bymonthdayslink").click(function(){calendar_gui.resetMonth()});
$("#byyeardaylink").click(function(){calendar_gui.resetYear("advanced")});$("#bymonthdaylink").click(function(){calendar_gui.resetYear()});$("#infinite").click(function(){$("#expires").val(rcmail.env.caleot.substr(0,10))});$("#mevery").change(function(){calendar_gui.checkAll("#form",false)});$("#mweekday").change(function(){calendar_gui.checkAll("#form",false)});$("#ymonthday").change(function(){calendar_gui.checkAll("#form",false);calendar_gui.resetYear("advanced")});$("#yevery").change(function(){calendar_gui.checkAll("#form",
false);calendar_gui.resetYear("default")});$("#yweekday").change(function(){calendar_gui.checkAll("#form",false);calendar_gui.resetYear("default")});$("#ymonth").change(function(){calendar_gui.checkAll("#form",false);calendar_gui.resetYear("default")});$("#export_to_file").click(function(){$("#send_invitation").prop("checked","");window.setTimeout("$('#export_to_file').prop('checked','');var $dialogContent = $('#event');$dialogContent.dialog('close');",1500);document.location.href=$("#export_as_file").attr("href")});
$("#send_invitation").click(function(){$("#export_to_file").prop("checked","");window.setTimeout("$('#send_invitation').prop('checked','');var $dialogContent = $('#event');$dialogContent.dialog('close');",1500)});this.createOptions=function(a,b,d){for(var g=d;g<=b;g=g+d)$(a).append($("<option></option>").val(g).html(g))};this.createOptions("#reminderminutesbefore",59,5);this.createOptions("#reminderhoursbefore",23,1);this.createOptions("#reminderdaysbefore",6,1);this.createOptions("#reminderweeksbefore",
4,1);this.reminderControls=function(){var a=true;$("#reminderenable").prop("checked")&&(a=false);$("#minsel").prop("disabled",a);$("#hoursel").prop("disabled",a);$("#daysel").prop("disabled",a);$("#weeksel").prop("disabled",a);$("#customreminder").prop("disabled",a);$("#remindertype").prop("disabled",a);$("#reminderminutesbefore").prop("disabled",a);$("#reminderhoursbefore").prop("disabled",a);$("#reminderdaysbefore").prop("disabled",a);$("#reminderweeksbefore").prop("disabled",a);$("#remindermailto").prop("disabled",
a)};$("#reminderenable").click(function(){calendar_gui.reminderControls()});$("#reminderdisable").click(function(){calendar_gui.reminderControls()});$("#remindertype").change(function(){$("#remindertype").val()=="email"?$("#remindermailto").attr("disabled",false):$("#remindermailto").attr("disabled",true)});$("#reminderminutesbefore").click(function(){$("#minsel").attr("checked",true)});$("#reminderhoursbefore").click(function(){$("#hoursel").attr("checked",true)});$("#reminderdaysbefore").click(function(){$("#daysel").attr("checked",
true)});$("#reminderweeksbefore").click(function(){$("#weeksel").attr("checked",true)});$("#customreminder").click(function(){if($("#remindercustom").val()=="--"){$("#customreminder").attr("checked",false);$("#hoursel").attr("checked",true)}});this.initAccordion();$("#calendaroverlay").hide()}};this.upcoming=function(a){$("#upcoming").fullCalendar("destroy");$("#upcoming").fullCalendar({header:{left:"",center:"",right:""},titleFormat:{month:a.settings.titleFormatMonth,week:a.settings.titleFormatWeek,
day:a.settings.titleFormatDay},columnFormat:{month:a.settings.columnFormatMonth,week:a.settings.columnFormatWeek,day:a.settings.columnFormatDay},theme:a.settings.ui_theme_upcoming,editable:true,ignoreTimezone:false,monthNames:a.settings.months,monthNamesShort:a.settings.months_short,dayNames:a.settings.days,dayNamesShort:a.settings.days_short,firstDay:a.settings.first_day,firstHour:a.settings.first_hour,slotMinutes:60/a.settings.timeslots,timeFormat:js_time_formats[rcmail.env.rc_time_format],axisFormat:js_time_formats[rcmail.env.rc_time_format],
defaultView:"basicDay",allDayText:rcmail.gettext("all-day","calendar"),height:1,dayClick:function(b,d,e,f){calendar_callbacks.dayClick(b,d,e,f,a)},eventClick:function(b){calendar_callbacks.eventClick(b,a)},eventRender:function(b,d,e){calendar_callbacks.eventRender_upcoming(b,d,e,a)}})};this.initTabs=function(a,b){$("#event").tabs();$("#event").tabs("enable",a);$("#event").tabs("disable",b);$("#event").tabs("select",0)};this.initAccordion=function(){$(function(){for(var a=0;a<4;a++)$("#accordion"+
a).accordion({autoHeight:false,collapsible:true,active:false})});for(var a=0;a<4;a++)$("#accordion"+a).accordion("option","header","span")};this.initClockPickers=function(a){$("#starttime").timepicker({timeOnlyTitle:rcmail.gettext("timeOnlyTitle","calendar"),timeText:rcmail.gettext("timeText","calendar"),hourText:rcmail.gettext("hourText","calendar"),minuteText:rcmail.gettext("minuteText","calendar"),stepMinute:1,currentText:rcmail.gettext("currentText","calendar"),closeText:rcmail.gettext("closeText",
"calendar"),onClose:function(){if($("#enddate").val()+$("#endtime").val()<=$("#startdate").val()+$("#starttime").val()){var b=$("#starttime").val().split(":"),b=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),parseFloat(b[0]),parseFloat(b[1]),0),d=new Date((b.getTime()/1E3+parseInt(a.settings.duration))*1E3),b=d.getHours()+"",d=d.getMinutes()+"";b.length<2&&(b="0"+b);d.length<2&&(d="0"+d);$("#endtime").val(b+":"+d)}},ampm:false});$("#endtime").timepicker({timeOnlyTitle:rcmail.gettext("timeOnlyTitle",
"calendar"),timeText:rcmail.gettext("timeText","calendar"),hourText:rcmail.gettext("hourText","calendar"),minuteText:rcmail.gettext("minuteText","calendar"),stepMinute:1,currentText:rcmail.gettext("currentText","calendar"),closeText:rcmail.gettext("closeText","calendar"),onClose:function(){if($("#enddate").val()+$("#endtime").val()<=$("#startdate").val()+$("#starttime").val()){var b=$("#starttime").val().split(":"),b=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),parseFloat(b[0]),
parseFloat(b[1]),0),d=new Date((b.getTime()/1E3+parseInt(a.settings.duration))*1E3),b=d.getHours()+"",d=d.getMinutes()+"";b.length<2&&(b="0"+b);d.length<2&&(d="0"+d);$("#endtime").val(b+":"+d)}},ampm:false})};this.initNavDatepicker=function(a){var b=new Date(0),d=new Date(rcmail.env.caleot_unix*1E3);if(a.settings.backend=="caldav"){d=new Date;b=d.getFullYear()-a.settings.caldav_replication_range.past;d=d.getFullYear()+a.settings.caldav_replication_range.future;b=new Date(b,0,1);d=new Date(d,11,31)}$("#jqdatepicker").datepicker({dateFormat:"yy-mm-dd",
firstDay:a.settings.first_day,minDate:b,maxDate:d,changeYear:true,changeMonth:true,onSelect:function(a){temparr=a.split("-");a=new Date(temparr[0],temparr[1]-1,temparr[2]);$("#calendar").fullCalendar("gotoDate",$.fullCalendar.parseDate(a));$("#upcoming").fullCalendar("gotoDate",$.fullCalendar.parseDate(a));var a=new Date($.fullCalendar.parseDate(a)),b=new Date;b.setTime(a.getTime()+8634E4);$("#calendar").fullCalendar("select",a,b,false)},onChangeMonthYear:function(a,b){if(rcmail.env.onChangeMonthYear){var d=
new Date(a,b-1,1);$("#calendar").fullCalendar("gotoDate",$.fullCalendar.parseDate(d));var d=new Date($.fullCalendar.parseDate(d)),g=new Date;g.setTime(d.getTime()+8634E4);$("#calendar").fullCalendar("select",d,g,false)}}})};this.initExpireDatepicker=function(a,b){var d=a.getDate()+"",e=a.getMonth()+"",f=a.getFullYear()+"";$("#expires").datepicker("destroy");$("#expires").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,firstDay:b.settings.first_day,maxDate:new Date(rcmail.env.caleot_unix*
1E3),minDate:new Date(f,e,d),onSelect:function(){$("#expires").val()<$("#enddate").val()&&$("#expires").val($("#enddate").val())}});d.length<2&&(d="0"+d);e=parseInt(e)+1+"";e.length<2&&(e="0"+e);$("#expires").val(f+"-"+e+"-"+d);rcmail.env.remember_expires=$("#expires").val()};this.initStartdateDatepicker=function(a,b){var d=a.getDate()+"",e=a.getMonth()+"",f=a.getFullYear()+"";$("#startdate").datepicker("destroy");$("#startdate").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,
firstDay:b.settings.first_day,maxDate:new Date(rcmail.env.caleot_unix*1E3),onSelect:function(){if($("#enddate").val()+$("#endtime").val()<=$("#startdate").val()+$("#starttime").val()){$("#enddate").val($("#startdate").val());var a=$("#starttime").val().split(":");(new Date).getFullYear();(new Date).getMonth();(new Date).getDate();parseFloat(a[0]);parseFloat(a[1])}$("#expires").val()<$("#enddate").val()&&$("#expires").val($("#enddate").val());calendar_gui.initReminderDatepicker(new Date($("#startdate").datepicker("getDate").getTime()+
86399E3),b)}});d.length<2&&(d="0"+d);e=parseInt(e)+1+"";e.length<2&&(e="0"+e);$("#startdate").val(f+"-"+e+"-"+d)};this.initEnddateDatepicker=function(a,b){var d=a.getDate()+"",e=a.getMonth()+"",f=a.getFullYear()+"";$("#enddate").datepicker("destroy");$("#enddate").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,firstDay:b.settings.first_day,maxDate:new Date(rcmail.env.caleot_unix*1E3),minDate:new Date(f,e,d),onSelect:function(){if($("#enddate").val()+$("#endtime").val()<=$("#startdate").val()+
$("#starttime").val()){$("#startdate").val($("#enddate").val());var a=$("#starttime").val().split(":");(new Date).getFullYear();(new Date).getMonth();(new Date).getDate();parseFloat(a[0]);parseFloat(a[1])}$("#expires").val()<$("#enddate").val()&&$("#expires").val($("#enddate").val())}});d.length<2&&(d="0"+d);e=parseInt(e)+1+"";e.length<2&&(e="0"+e);$("#enddate").val(f+"-"+e+"-"+d)};this.initReminderDatepicker=function(a,b){$("#remindercustom").datetimepicker("destroy");$("#remindercustom").val("--");
a.getTime()>(new Date).getTime()&&$("#remindercustom").datetimepicker({timeText:rcmail.gettext("timeText","calendar"),hourText:rcmail.gettext("hourText","calendar"),minuteText:rcmail.gettext("minuteText","calendar"),currentText:rcmail.gettext("currentText","calendar"),closeText:rcmail.gettext("closeText","calendar"),dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,firstDay:b.settings.first_day,onSelect:function(){$("#customreminder").attr("checked",true)},maxDate:new Date(a),minDate:new Date})};
this.resetForm=function(a){$("input, textarea, select","#form").each(function(){$(this).prop("disabled",false)});$("#recursel").prop("disabled",true);$("#everyweekdiv").hide();$("#everymonthdiv").hide();$("#everyyeardiv").hide();$("#everydaydiv").hide();for(var b=0;b<5;b++)b!=3&&calendar_gui.initTabs(b,3);a.find("input:text").val("");a.find("textarea").val("");$("#description-container").html('<textarea name="description" id="description" rows="15" cols="39"></textarea>');a.find("select").prop("selectedIndex",
0);a.find("input:radio").attr("checked",false);$("#reminderdisable").attr("checked",true);a.find("input:checkbox").attr("checked",false);$("#remindermailto").attr("disabled",false)};this.resetDay=function(){$("#dnums").val(1)};this.resetWeek=function(){$("#wnums").val(1);$(".byweekdays").attr("checked",false)};this.resetMonth=function(a){if(a=="advanced"){$("#mevery").prop("selectedIndex",0);$("#mweekday").prop("selectedIndex",0)}else a=="occurrences"?$("#mnums").val(1):$(".bymonthdays").attr("checked",
false)};this.resetYear=function(a){if(a=="advanced"){$("#yweekday").prop("selectedIndex",0);$("#yevery").prop("selectedIndex",0);$("#ymonth").prop("selectedIndex",0)}else if(a=="occurrences")$("#ynums").val(1);else{$("#ydnums").val(1);$("#ymonthday").prop("selectedIndex",0)}};this.toggleRecur=function(){var a=$("#recursel");if(a.prop("selectedIndex")==0){$("#occurrences").val(0);$("#schedule").hide()}else $("#schedule").show();this.checkAll("#form",false);$("#dnums").val(1);$("#wnums").val(1);$("#mnums").val(1);
$("#ynums").val(1);$("#ydnums").val(0);if(a.prop("selectedIndex")>=0){calendar_gui.initAccordion();$("#rrules").show()}a.prop("selectedIndex")==0?$("#reset").hide():$("#reset").show();if(a.prop("selectedIndex")==1){this.currentStyle("daylink")&&$("#everyweekdiv").hide();$("#everymonthdiv").hide();$("#everyyeardiv").hide();$("#daylink").click()}else if(a.prop("selectedIndex")==2)$("#rrules").hide();else if(a.prop("selectedIndex")==3){if(this.currentStyle("weeklink")){$("#everydaydiv").hide();$("#everymonthdiv").hide();
$("#everyyeardiv").hide();$("#weeklink").click()}}else if(a.prop("selectedIndex")==4){if(this.currentStyle("monthlink")){$("#everydaydiv").hide();$("#everyweekdiv").hide();$("#everyyeardiv").hide();$("#monthlink").click()}}else if(a.prop("selectedIndex")==5&&this.currentStyle("yearlink")){$("#everydaydiv").hide();$("#everyweekdiv").hide();$("#everymonthdiv").hide();$("#yearlink").click()}};this.checkAll=function(a,b){a==null||a==void 0||$(a+" input[type=checkbox]").each(function(){this.checked=b})};
this.nums=function(a,b,d){$("#"+b).val()==""&&$("#"+b).val(0);d&&a>0&&parseInt($("#"+b).val())>=d&&(a=0);$("#"+b).val(Math.max(0,parseInt($("#"+b).val())+a))};this.currentStyle=function(a){a=document.getElementById(a);if(a.currentStyle){str=a.currentStyle.color;c=rcmail.env.linkcolor}else if(window.getComputedStyle){str=window.getComputedStyle(a,null).color;c=rcmail.env.rgblinkcolor}return str!=c?true:false};this.getView=function(a){return queryString("_view")!="false"?queryString("_view"):a.settings.default_view}}
calendar_gui=new calendar_gui;