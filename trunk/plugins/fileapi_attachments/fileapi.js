if("undefined"!==typeof FileReader){var FA=FA||{};(function(){var c,g,d;FA.setup=function(){d="attachmentslist";if("larry"==rcmail.env.skin)d="attachment-list";else if("litecube-f"==rcmail.env.skin||"litecube"==rcmail.env.skin)d="rcmAttachmentList";g=document.getElementById(d);c=document.getElementById("compose-attachments");c.addEventListener("dragenter",function(a){this.style.backgroundColor="#e2eeff";a.stopPropagation();a.preventDefault()},!1);c.addEventListener("dragleave",function(){this.style.backgroundColor=
""},!1);c.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault()},!1);c.addEventListener("drop",FA.handleDrop,!1)};FA.uploadProgressXHR=function(a){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);100>b&&(a.target.log.firstChild.nextSibling.nextSibling.nextSibling.style.width=b+"%",a=$(".mainaction").get(0),$(a).attr("onclick",'alert(rcmail.gettext("notuploadedwarning"))'))}};FA.loadedXHR=function(a){currentImageItem=a.target.log;progressItem=currentImageItem.firstChild.nextSibling.nextSibling.nextSibling;
currentImageItem.removeChild(progressItem);progressCircle=currentImageItem.firstChild.nextSibling;currentImageItem.removeChild(progressCircle)};FA.uploadError=function(a){console.log("error: "+a);a=$(".mainaction").get(0);$(a).attr("onclick",'return rcmail.command("send","",this)')};FA.processXHR=function(a,b,c,d){xhr=new XMLHttpRequest;fileUpload=xhr.upload;fileUpload.log=d;fileUpload.addEventListener("progress",FA.uploadProgressXHR,!1);fileUpload.addEventListener("load",FA.loadedXHR,!1);xhr.onreadystatechange=
FA.onReadyStateChange;fileUpload.addEventListener("error",FA.uploadError,!1);xhr.open("POST",rcmail.env.comm_path+"&_action=plugin.upload_fileapi&_id="+rcmail.env.compose_id+"&_name="+a.name+"&_uploadid="+c);xhr.overrideMimeType("text/plain; charset=x-user-defined-binary");xhr.send(a)};FA.onReadyStateChange=function(){if(4==this.readyState){var a=this.responseText,a=a.substring(a.indexOf("CDATA")+10),a=a.substring(0,a.indexOf("/* ]]\> */")),a=a.replace(/var rcmail = new rcube_webmail\(\);/g,""),a=
a.replace("if(window.parent) {",""),a=a.replace(/if\(window\.parent && parent\.rcmail\)/g,""),a=a.replace(/parent/g,"window"),a=a.substr(0,a.lastIndexOf("window.rcmail.add_label"));if($(this.upload.log).is(":visible"))g.removeChild(this.upload.log),a=a.replace("fauploadhidden","");else var b=a.replace("window.rcmail.add2attachment_list(",'rcmail.command("remove-attachment",');eval(a);b&&eval(b);a=$(".mainaction").get(0);$(a).attr("onclick",'return rcmail.command("send","",this)');$("#"+d+" a").each(function(){$(this).hasClass("delete")||
$(this).addClass("delete")})}};FA.handleDrop=function(a){this.style.backgroundColor="";var b=a.dataTransfer.files,c=document.createDocumentFragment(),d=b.length;a.stopPropagation();a.preventDefault();for(var f=10*(new Date).getTime(),e=0;e<d;e++)if(b[e].size<rcmail.env.max_filesize){a=[document.createElement("li"),document.createElement("a"),document.createElement("img"),document.createElement("img"),document.createElement("div"),document.createElement("img"),document.createElement("div")];a[1].href=
"#cancelupload";a[1].onclick=function(){$(this).parent().hide()};a[1].title=rcmail.gettext("cancel");"larry"==rcmail.env.skin?(a[1].className="cancelupload",a[0].className="uploading"):(a[2].src="skins/"+rcmail.env.skin+"/images/icons/delete.png",a[3].src="skins/"+rcmail.env.skin+"/images/display/loading_blue.gif");a[1].appendChild(a[2]);a[0].id=f;a[0].appendChild(a[1]);a[0].appendChild(a[3]);a[0].appendChild(document.createTextNode(b[e].name));a[4].style.border="1px solid #0000ff";a[4].style.width=
0;a[4].id="progress_"+f;a[0].appendChild(a[4]);c.appendChild(a[0]);g.appendChild(c);f++;var h=$(".mainaction").get(0);$(h).attr("onclick",'alert(rcmail.gettext("notuploadedwarning"))');FA.processXHR(b.item(e),e,f,a[0])}else rcmail.display_message(rcmail.env.filesizeerror,"error")};window.addEventListener("load",FA.setup,!1)})()}$(document).ready(function(){$("body").append('<div id="dragupload">'+rcmail.gettext("fileapi_attachments.dragupload")+"</div>")});